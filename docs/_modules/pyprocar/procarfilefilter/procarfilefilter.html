

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyprocar.procarfilefilter.procarfilefilter &mdash; PyProcar 5.5.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> PyProcar
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cite.html">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dftprep.html">DFT Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">pyprocar API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyProcar</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pyprocar.procarfilefilter.procarfilefilter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyprocar.procarfilefilter.procarfilefilter</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">..utilsprocar</span> <span class="kn">import</span> <span class="n">UtilsProcar</span>


<div class="viewcode-block" id="ProcarFileFilter"><a class="viewcode-back" href="../../../pyprocar.procarfilefilter.html#pyprocar.procarfilefilter.procarfilefilter.ProcarFileFilter">[docs]</a><span class="k">class</span> <span class="nc">ProcarFileFilter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Process a PROCAR file fields line-wise, specially useful for HUGE</span>
<span class="sd">  files. This could be thought as pre-processing, writting a new</span>
<span class="sd">  PROCAR-like file but reduced in some way.</span>

<span class="sd">  A PROCAR File is basically an multi-dimmensional arrays of data, the</span>
<span class="sd">  largest being:</span>
<span class="sd">  spd_data[#kpoints][#band][#ispin][#atom][#orbital]</span>

<span class="sd">  while the number of Kpoints d&#39;ont seems a target for reduction</span>
<span class="sd">  (omission or averaging), the other fields can be reduced, for</span>
<span class="sd">  instance: grouping the atoms by species or as &quot;surtrate&quot; and</span>
<span class="sd">  &quot;adsorbate&quot;, or just keeping the bands close to the Fermi energy, or</span>
<span class="sd">  discarding the d-orbitals in a s-p system. You got the idea, rigth?</span>

<span class="sd">  Example:</span>

<span class="sd">  -To group the &quot;s&quot;, &quot;p&quot; y &quot;d&quot; orbitals from the file PROCAR and write</span>
<span class="sd">   them in PROCAR-spd:</span>

<span class="sd">   &gt;&gt;&gt; a = procar.ProcarFileFilter(&quot;PROCAR&quot;, &quot;PROCAR-new&quot;)</span>
<span class="sd">   &gt;&gt;&gt; a.FilterOrbitals([[0],[1,2,3],[4,5,6,7,8]], [&#39;s&#39;,&#39;p&#39;, &#39;d&#39;])</span>

<span class="sd">       The PROCAR-new will have just 3+1 columns (orbitals are colum-wise</span>
<span class="sd">       , take a look to the file). If you omit the [&#39;s&#39;, &#39;p&#39;, &#39;d&#39;] list,</span>
<span class="sd">       the new orbitals will have a generic meaningless name (o1, o2, o3)</span>

<span class="sd">  -To group the atoms 1,2,5,6 and 3,4,7,8 from PROCAR and write them</span>
<span class="sd">   in PROCAR-new (note the 0-based indexes):</span>

<span class="sd">   &gt;&gt;&gt; a = procar.ProcarFileFilter(&quot;PROCAR&quot;, &quot;PROCAR-new&quot;)</span>
<span class="sd">   &gt;&gt;&gt; a.FilterAtoms([[0,1,4,5],[2,3,6,7]])</span>

<span class="sd">   -To select just the total density (ie: ignoring the spin-resolved stuff,</span>
<span class="sd">    if any)from PROCAR and write it in PROCAR-new:</span>

<span class="sd">   &gt;&gt;&gt; a = procar.ProcarFileFilter(&quot;PROCAR&quot;, &quot;PROCAR-new&quot;)</span>
<span class="sd">   &gt;&gt;&gt; a.FilterSpin([0])</span>

<span class="sd">  &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loglevel</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">    Params: `infile=None`, input fileName</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infile</span> <span class="o">=</span> <span class="n">infile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span>

        <span class="c1"># We want a logging to tell us what is happening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ProcarFileFilter&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">loglevel</span><span class="p">)</span>
        <span class="c1"># This is a handler for logging, by now just keep it</span>
        <span class="c1"># untouched. Dont really matters its usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ch</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(name)s</span><span class="s2">::</span><span class="si">%(levelname)s</span><span class="s2">:&quot;</span> <span class="s2">&quot; </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">)</span>
        <span class="c1"># At last, one message to the logger.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ProcarFileFilter instanciated&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1">##########################SCRIPTS#################################</span>

    <span class="c1"># def scriptFilter(self,inFile,outFile,atoms=None,orbitals=None,orbital_names=None,bands=None,spin=None,human_atoms=False):</span>
    <span class="c1">#   print &quot;Input file  :&quot;, inFile</span>
    <span class="c1">#   print &quot;Output file :&quot;, outFile</span>

    <span class="c1">#   print &quot;atoms       :&quot;, atoms</span>
    <span class="c1">#   if atoms:</span>
    <span class="c1">#     print &quot;human_atoms     :&quot;, human_atoms</span>
    <span class="c1">#   print &quot;orbitals  :&quot;, orbitals</span>
    <span class="c1">#   if orbitals:</span>
    <span class="c1">#       print &quot;orb. names  :&quot;, orbital_names</span>
    <span class="c1">#     print &quot;bands       :&quot;, bands</span>
    <span class="c1">#     print &quot;spins       :&quot;, spin</span>

    <span class="c1">#   #Access init class of ProcarFileFilter and pass two arguments</span>
    <span class="c1">#   FileFilter = ProcarFileFilter(inFile,outFile)</span>

    <span class="c1">#   #for atoms</span>
    <span class="c1">#   if atoms:</span>
    <span class="c1">#     print &quot;Manipulating the atoms&quot;</span>

    <span class="c1">#     if human_atoms:</span>
    <span class="c1">#       atoms = [[y-1 for y in x] for x in atoms]</span>
    <span class="c1">#       print &quot;new atoms list :&quot;, atoms</span>

    <span class="c1">#     #Now just left to call the driver member</span>
    <span class="c1">#     FileFilter.FilterAtoms(atoms)</span>

    <span class="c1">#   #for orbitals</span>
    <span class="c1">#   elif orbitals:</span>
    <span class="c1">#     print &quot;Manipulating the orbitals&quot;</span>
    <span class="c1">#     #If orbitals orbital_names is None, it needs to be filled</span>
    <span class="c1">#     if orbital_names is None:</span>
    <span class="c1">#       orbital_names = [&quot;o&quot;+str(x) for x in range(len(orbitals))]</span>
    <span class="c1">#       print &quot;New orbitals names (default): &quot;, orbital_names</span>
    <span class="c1">#     #testing if makes sense</span>
    <span class="c1">#     if len(orbitals) != len(orbital_names):</span>
    <span class="c1">#       raise RuntimeError(&quot;length of orbitals and orbitals names do not match&quot;)</span>

    <span class="c1">#     FileFilter.FilterOrbitals(orbitals,orbital_names)</span>

    <span class="c1">#   #for bands</span>
    <span class="c1">#   elif bands:</span>
    <span class="c1">#     print &quot;Manipulating the bands&quot;</span>

    <span class="c1">#     bmin = bands[0]</span>
    <span class="c1">#     bmax = bands[1]</span>
    <span class="c1">#     if bmax &lt; bmin:</span>
    <span class="c1">#       bmax, bmin = bmin, bmax</span>
    <span class="c1">#       print &quot;New bands limits: &quot;, bmin, &quot; to &quot;, bmax</span>

    <span class="c1">#     FileFilter.FilterBands(bmin,bmax)</span>

    <span class="c1">#   #for spin</span>
    <span class="c1">#   elif spin:</span>
    <span class="c1">#     print &quot;Manipulating the spin&quot;</span>

    <span class="c1">#     FileFilter.FilterSpin(spin)</span>

    <span class="c1">#   return</span>

    <span class="c1">##################################################################</span>

<div class="viewcode-block" id="ProcarFileFilter.setInFile"><a class="viewcode-back" href="../../../pyprocar.procarfilefilter.html#pyprocar.procarfilefilter.procarfilefilter.ProcarFileFilter.setInFile">[docs]</a>    <span class="k">def</span> <span class="nf">setInFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a input file `infile`, it can contains the path to the file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infile</span> <span class="o">=</span> <span class="n">infile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Input File: &quot;</span> <span class="o">+</span> <span class="n">infile</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="ProcarFileFilter.setOutFile"><a class="viewcode-back" href="../../../pyprocar.procarfilefilter.html#pyprocar.procarfilefilter.procarfilefilter.ProcarFileFilter.setOutFile">[docs]</a>    <span class="k">def</span> <span class="nf">setOutFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a output file `outfile`, it can contains the path to the file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Out File: &quot;</span> <span class="o">+</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="ProcarFileFilter.FilterOrbitals"><a class="viewcode-back" href="../../../pyprocar.procarfilefilter.html#pyprocar.procarfilefilter.procarfilefilter.ProcarFileFilter.FilterOrbitals">[docs]</a>    <span class="k">def</span> <span class="nf">FilterOrbitals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orbitals</span><span class="p">,</span> <span class="n">orbitalsNames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the file already set by SetInFile() and writes a new</span>
<span class="sd">    file already set by SetOutFile(). The new file only has the</span>
<span class="sd">    selected/grouped orbitals.</span>

<span class="sd">    Args:</span>

<span class="sd">    -orbitals: nested iterable with the orbitals indexes to be</span>
<span class="sd">      considered. For example: [[0],[2]] means select the first</span>
<span class="sd">      orbital (&quot;s&quot;) and the second one (&quot;pz&quot;).</span>
<span class="sd">      [[0],[1,2,3],[4,5,6,7,8]] is [&quot;s&quot;, &quot;p&quot;, &quot;d&quot;].</span>

<span class="sd">    -orbitalsNames: The name to be put in each new orbital field (of a</span>
<span class="sd">      orbital line). For example [&quot;s&quot;,&quot;p&quot;,&quot;d&quot;] is a good</span>
<span class="sd">      `orbitalsName` for the `orbitals`=[[0],[1,2,3],[4,5,6,7,8]].</span>
<span class="sd">      However, [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;] is equally valid.</span>

<span class="sd">    Note:</span>
<span class="sd">      -The atom index is not counted as the first field.</span>
<span class="sd">      -The last column (&#39;tot&#39;) is so important that it is always</span>
<span class="sd">       included. Do not needs to be called</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="c1"># setting iostuff, this method -and class- should not made any</span>
        <span class="c1"># checking about IO, that is the job of the caller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;In File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Out File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
        <span class="c1"># open the files</span>
        <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fopener</span> <span class="o">=</span> <span class="n">UtilsProcar</span><span class="p">()</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="n">fopener</span><span class="o">.</span><span class="n">OpenFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*ion\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="c1"># self.log.debug(&quot;orbital line found: &quot; + line)</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;ion&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">orbitalsNames</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;tot&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\d+\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*tot\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="c1"># self.log.debug(&quot;data line found: &quot; + line)</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="c1"># all floats to an array</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="c1"># setting a new line, keeping just the first value</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">orbset</span> <span class="ow">in</span> <span class="n">orbitals</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">orbset</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="c1"># the last value (&quot;tot&quot;) always  should be written</span>
                <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># converting to str</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ProcarFileFilter.FilterAtoms"><a class="viewcode-back" href="../../../pyprocar.procarfilefilter.html#pyprocar.procarfilefilter.procarfilefilter.ProcarFileFilter.FilterAtoms">[docs]</a>    <span class="k">def</span> <span class="nf">FilterAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomsGroups</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the file already set by SetInFile() and writes a new</span>
<span class="sd">    file already set by SetOutFile(). The new file only has the</span>
<span class="sd">    selected/grouped atoms.</span>

<span class="sd">    Args:</span>

<span class="sd">    -atomsGroups: nested iterable with the atoms indexes (0-based) to</span>
<span class="sd">      be considered. For example: [[0],[2]] means select the first and</span>
<span class="sd">      the second atoms. While [[1,2,3],[4,5,6,7,8]] means select the</span>
<span class="sd">      contribution of atoms 1+2+3 and 4+5+6+7+8</span>

<span class="sd">    Note:</span>
<span class="sd">      -The atom index is c-based (or python) beginning with 0</span>
<span class="sd">      -The output has a dummy atom index, without any intrisic meaning</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="c1"># setting iostuff, this method -and class- should not made any</span>
        <span class="c1"># checking about IO, that is the job of the caller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;In File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Out File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
        <span class="c1"># open the files</span>
        <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fopener</span> <span class="o">=</span> <span class="n">UtilsProcar</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">fopener</span><span class="o">.</span><span class="n">OpenFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
            <span class="c1"># I need to change the numbers of ions, it will needs the second</span>
            <span class="c1"># line. The first one is not needed</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c1"># the very last value needs to be changed</span>
            <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atomsGroups</span><span class="p">))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># now parsing the rest of the file</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
                <span class="c1"># if line has data just capture it</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\d+\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="c1"># self.log.debug(&quot;atoms line found: &quot; + line)</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="c1"># if `line` is a end of th block (begins with &#39;tot&#39;), do the</span>
                <span class="c1"># work. And clean up data then</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*tot\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="c1"># self.log.debug(&quot;tot line found: &quot; + line)</span>
                    <span class="c1"># making an array</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                    <span class="c1"># iterating on the atoms groups</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atomsGroups</span><span class="p">)):</span>
                        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atomsGroups</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                        <span class="c1"># summing colum-wise</span>
                        <span class="n">atomLine</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">atomLine</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atomLine</span><span class="p">]</span>
                        <span class="c1"># the atom index should not be averaged (anyway now is</span>
                        <span class="c1"># meaningless)</span>
                        <span class="n">atomLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">atomLine</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atomLine</span><span class="p">)</span>
                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">atomLine</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># clean the buffer</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="c1"># and write the `tot` line</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="c1"># otherwise just write this line</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ProcarFileFilter.FilterBands"><a class="viewcode-back" href="../../../pyprocar.procarfilefilter.html#pyprocar.procarfilefilter.procarfilefilter.ProcarFileFilter.FilterBands">[docs]</a>    <span class="k">def</span> <span class="nf">FilterBands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Min</span><span class="p">,</span> <span class="n">Max</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the file already set by SetInFile() and writes a new</span>
<span class="sd">    file already set by SetOutFile(). The new file only has the</span>
<span class="sd">    selected bands.</span>

<span class="sd">    Args:</span>

<span class="sd">    -Min, Max:</span>
<span class="sd">      the minimum/maximum band  index to be considered, the indexes</span>
<span class="sd">      are the same used by vasp (ie written in the file).</span>


<span class="sd">    Note: -Since bands are somewhat disordered in vasp you may like to</span>
<span class="sd">      consider a large region and made some trial and error</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="c1"># setting iostuff, this method -and class- should not made any</span>
        <span class="c1"># checking about IO, that is the job of the caller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;In File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Out File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
        <span class="c1"># open the files</span>
        <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fopener</span> <span class="o">=</span> <span class="n">UtilsProcar</span><span class="p">()</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="n">fopener</span><span class="o">.</span><span class="n">OpenFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>

        <span class="c1"># I need to change the numbers of kpoints, it will needs the second</span>
        <span class="c1"># line. The first one is not needed</span>
        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># the third value needs to be changed, however better print it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;The line contaning bands number is &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;The number of bands is: &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Max</span> <span class="o">-</span> <span class="n">Min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># now parsing the rest of the file</span>
        <span class="n">write</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*band\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="c1"># self.log.debug(&quot;bands line found: &quot; + line)</span>
                <span class="n">band</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*band\s*(\d+)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">band</span> <span class="o">&lt;</span> <span class="n">Min</span> <span class="ow">or</span> <span class="n">band</span> <span class="o">&gt;</span> <span class="n">Max</span><span class="p">:</span>
                    <span class="n">write</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">write</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*k-point\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">write</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="ProcarFileFilter.FilterSpin"><a class="viewcode-back" href="../../../pyprocar.procarfilefilter.html#pyprocar.procarfilefilter.procarfilefilter.ProcarFileFilter.FilterSpin">[docs]</a>    <span class="k">def</span> <span class="nf">FilterSpin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">components</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the file already set by SetInFile() and writes a new</span>
<span class="sd">    file already set by SetOutFile(). The new file only has the</span>
<span class="sd">    selected part of the density (sigma_i).</span>

<span class="sd">    Args:</span>

<span class="sd">    -components: For non colinear spin calculations</span>
<span class="sd">      the spin component block, for instante [0] menas just</span>
<span class="sd">      the density, while [1,2] would be the the sigma_x and sigma_y.</span>
<span class="sd">      For colinear spin polarized calculations [0] means spin up</span>
<span class="sd">      component and [1] spin down component.</span>


<span class="sd">    UPDATE: Colinear spin calculation implemented. It uses regex to</span>
<span class="sd">            check for the type of calculation. Hopefully, this won&#39;t</span>
<span class="sd">            be an issue with memory nowadays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="c1"># setting iostuff, this method -and class- should not made any</span>
        <span class="c1"># checking about IO, that is the job of the caller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;In File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Out File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>

        <span class="c1"># First let&#39;s see if this is a spin colinear calculation.</span>
        <span class="n">fopener</span> <span class="o">=</span> <span class="n">UtilsProcar</span><span class="p">()</span>
        <span class="n">fin_test</span> <span class="o">=</span> <span class="n">fopener</span><span class="o">.</span><span class="n">OpenFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fin_test</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">colinear_counter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;#\sof\sk-points:&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colinear_counter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># This is a non colinear spin calculation.</span>
            <span class="c1"># (Or no spin. But why would anyone want to filter spins in that?)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Non colinear spin calculation detected.&quot;</span><span class="p">)</span>

            <span class="c1"># open the files</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">fopener</span> <span class="o">=</span> <span class="n">UtilsProcar</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">fopener</span><span class="o">.</span><span class="n">OpenFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
                    <span class="c1"># if any data found</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\d&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="c1"># check if should be written</span>
                        <span class="k">if</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*tot&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="c1"># the next block will belong to other component</span>
                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*ion&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">colinear_counter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># This is a colinear spin calculation.</span>
            <span class="c1"># The idea is to seperate spin up [0] and down [1] components</span>
            <span class="c1"># and store them in two different PROCARS.</span>
            <span class="c1"># They can then be used to plot spin up and spin down</span>
            <span class="c1"># bands seperately without plotting spin density or</span>
            <span class="c1"># spin magnetization.</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Colinear spin calculation detected.&quot;</span><span class="p">)</span>

            <span class="c1"># open the files</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">fopener</span> <span class="o">=</span> <span class="n">UtilsProcar</span><span class="p">()</span>
            <span class="n">spindown_buffer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">component_counter</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">with</span> <span class="n">fopener</span><span class="o">.</span><span class="n">OpenFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;PROCAR\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="c1"># First line of the file.</span>
                        <span class="n">spindown_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;#\sof\sk-points:&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="n">component_counter</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">component_counter</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># Write to file for spin up component.</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                            <span class="c1"># Keep on writing line by line until the start of</span>
                            <span class="c1"># the next component, i.e. &quot;# of k-points:&quot;.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Save spin down component to buffer.</span>
                        <span class="c1"># Save later if asked.</span>
                        <span class="n">spindown_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spindown_buffer</span><span class="p">:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ProcarFileFilter.FilterKpoints"><a class="viewcode-back" href="../../../pyprocar.procarfilefilter.html#pyprocar.procarfilefilter.procarfilefilter.ProcarFileFilter.FilterKpoints">[docs]</a>    <span class="k">def</span> <span class="nf">FilterKpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Min</span><span class="p">,</span> <span class="n">Max</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the file already set by SetInFile() and writes a new</span>
<span class="sd">    file already set by SetOutFile(). The new file the</span>
<span class="sd">    selected bands.</span>

<span class="sd">    Args:</span>

<span class="sd">    -Min, Max:</span>
<span class="sd">      the minimum/maximum band  kpoint to be considered, the indexes</span>
<span class="sd">      are the same used by vasp (i.e. written in the file). Not starting from zero</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="c1"># setting iostuff, this method -and class- should not made any</span>
        <span class="c1"># checking about IO, that is the job of the caller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;In File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Out File: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
        <span class="c1"># open the files</span>
        <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fopener</span> <span class="o">=</span> <span class="n">UtilsProcar</span><span class="p">()</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="n">fopener</span><span class="o">.</span><span class="n">OpenFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>

        <span class="c1"># I need to change the numbers of kpoints, it will needs the second</span>
        <span class="c1"># line. The first one is not needed</span>
        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1"># the third value needs to be changed, however better print it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;The line contaning kpoints number is &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;The number of kpoints is: &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Max</span> <span class="o">-</span> <span class="n">Min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># now parsing the rest of the file</span>
        <span class="n">write</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*k-point\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;bands line found: &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">kpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*k-point\s*(\d+)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">kpoint</span> <span class="o">&lt;</span> <span class="n">Min</span> <span class="ow">or</span> <span class="n">kpoint</span> <span class="o">&gt;</span> <span class="n">Max</span><span class="p">:</span>
                    <span class="n">write</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">write</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Romero Group

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>